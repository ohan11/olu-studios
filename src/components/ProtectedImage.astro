---
interface Props {
  src: string;
  alt?: string;
  width?: string | number;
  height?: string | number;
  class?: string;
}

const { src, alt = '', width, height, class: className = '' } = Astro.props;
const style = width || height ? `width: ${width || 'auto'}; height: ${height || 'auto'};` : '';
---

<img
  src={src}
  alt={alt}
  width={typeof width === 'number' ? width : undefined}
  height={typeof height === 'number' ? height : undefined}
  style={style}
  class={`protected-image ${className}`}
  data-protected="true"
/>

<style>
  .protected-image {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    pointer-events: auto;
    -webkit-user-drag: none;
    -khtml-user-drag: none;
    -moz-user-drag: none;
    -o-user-drag: none;
    user-drag: none;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const images = document.querySelectorAll('img[data-protected="true"]');
    
    images.forEach((img) => {
      // Disable right-click
      img.addEventListener('contextmenu', (e) => {
        e.preventDefault();
        return false;
      });
      
      // Disable drag
      img.addEventListener('dragstart', (e) => {
        e.preventDefault();
        return false;
      });
      
      // Disable image saving shortcuts
      img.addEventListener('keydown', (e) => {
        if ((e.ctrlKey || e.metaKey) && (e.key === 's' || e.key === 'i')) {
          e.preventDefault();
          return false;
        }
      });
      
      // Prevent text selection on image
      img.style.webkitTouchCallout = 'none';
      img.style.webkitUserSelect = 'none';
    });
  });
</script>
